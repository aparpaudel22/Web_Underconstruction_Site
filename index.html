<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Under Construction | Apar Paudel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #000000e1;
    overflow: hidden;
    color: rgba(255, 255, 255, 0.85);
}

canvas {
    position: fixed;
    inset: 0;
    z-index: 1;
    touch-action: none;
}

.overlay {
    position: fixed;
    inset: 0;
    z-index: 3;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    pointer-events: auto;
    transition: all 0.8s ease;
}

.overlay.top {
    justify-content: flex-start;
    top: 20px;
}

h1 {
    font-size: 2.8rem;
    margin-bottom: 10px;
    animation: pulse 2s infinite;
}

#mainText {
    opacity: 0.85;
    margin: 6px 0;
    transition: all 0.8s ease;
    font-size: 1.2rem;
}

#gameOverContainer {
    display: none; /* hidden initially */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    z-index: 10;
}

#gameOverText {
    font-size: clamp(40px, 8vw, 80px);
    font-weight: bold;
    color: rgba(255, 0, 0, 0.938);
    margin-bottom: 20px;
}

#failActions button {
    font-size: clamp(16px, 3vw, 24px);
    padding: 12px 26px;
}

button {
    background: #0066ffbe;
    border: none;
    padding: 12px 26px;
    font-size: 1rem;
    border-radius: 4px;
    cursor: pointer;
    margin: 6px;
    z-index: 4;
}

footer {
    position: fixed;
    bottom: 12px;
    width: 100%;
    text-align: center;
    font-size: 0.85rem;
    opacity: 0.45;
    z-index: 2;
}

.controls {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 3;
    display: none;
    gap: 10px;
}

/* Mobile arrow buttons */
#leftArrow {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 5;
    background: #0066ffbe;
    border: none;
    padding: 20px;
    font-size: 1.5rem;
    border-radius: 50%;
    display: none;
}

#rightArrow {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 5;
    background: #0066ffbe;
    border: none;
    padding: 20px;
    font-size: 1.5rem;
    border-radius: 50%;
    display: none;
}

@keyframes pulse {
    0% {opacity: 0.6;}
    50% {opacity: 1;}
    100% {opacity: 0.6;}
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div class="overlay" id="overlay">
    <h1>üöß Under Construction üöß</h1>
    <div id="overlayContent">
        <p id="mainText">This website is currently being built.</p>
        <p>While you‚Äôre here, feel free to play a short game.</p>
        <p>Click Start Game below. Catch the blocks falling down.</p>
        <p>To play move the Catcher LEFT AND RIGHT.</p>
        <div id="gameOverContainer">
            <div id="gameOverText">GAME OVER</div>
            <div class="actions" id="failActions">
                <button id="playAgainBtn" onclick="startGame()">Play Again</button>
            </div>
        </div>
        <div class="actions">
            <button id="startBtn" onclick="startGame()">Start Game</button>
        </div>
    </div>
</div>

<div class="controls" id="controls">
    <button id="muteBtn" onclick="toggleMusic()">Mute</button>
    <button onclick="exitGame()">Exit</button>
</div>

<!-- Mobile Arrow Buttons -->
<button id="leftArrow">‚¨ÖÔ∏è</button>
<button id="rightArrow">‚û°Ô∏è</button>

<footer>¬© 2025 Apar Paudel. All rights reserved.</footer>

<audio id="bgMusic" src="assets/Music.mp3.mp3" loop></audio>
<audio id="failMusic" src="assets/Music2.mp3.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const music = document.getElementById("bgMusic");
const failMusic = document.getElementById("failMusic");

let blocks = [];
let lastBlockY = -40;
let zoneWidth = 300, zoneX, zoneMaxX;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    zoneX = canvas.width/2 - zoneWidth/2;
    zoneMaxX = zoneX + zoneWidth - 40;
}
resize();
window.addEventListener("resize", resize);

let catcher, score = 0, highScore = parseInt(localStorage.getItem("highScore")) || 0, speed = 1, running = false;
let difficultyMultiplier = 1;
let failed = false;

/* INIT GAME */
function init() {
    catcher = { x: canvas.width/2 - 70, y: canvas.height - 60, width: 90, height: 9 };
    blocks = [];
    lastBlockY = canvas.height * 0.1; 
    score = 0;
    speed = 1;
    difficultyMultiplier = 1;
    running = true;
    failed = false;

    const overlay=document.getElementById("overlay");
    overlay.classList.add("top");

    const overlayContent=document.getElementById("overlayContent");
    Array.from(overlayContent.children).forEach(c=>{
        if(c.id!=="mainText" && c.id!=="startBtn" && c.id!=="gameOverContainer") c.style.display="none";
    });
    document.getElementById("startBtn").style.display="none";

    document.getElementById("gameOverContainer").style.display="none";

    // Show mobile arrows only on small devices
    if(window.innerWidth < 768){
        document.getElementById("leftArrow").style.display = "block";
        document.getElementById("rightArrow").style.display = "block";
    } else {
        document.getElementById("leftArrow").style.display = "none";
        document.getElementById("rightArrow").style.display = "none";
    }
}

/* INPUT */
function moveCatcher(dx){
    catcher.x += dx;
    if(catcher.x<0) catcher.x=0;
    if(catcher.x+catcher.width>canvas.width) catcher.x = canvas.width - catcher.width;
}
addEventListener("keydown", e=>{
    if(!running) return;
    if(e.key==="ArrowLeft") moveCatcher(-40);
    if(e.key==="ArrowRight") moveCatcher(40);
});

// Mobile Touch
let touchStartX = null;
let touchStartY = null;
let touchEndY = null;

canvas.addEventListener("touchstart", e => {
    if (!running) return;
    e.preventDefault();
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
}, { passive: false });

canvas.addEventListener("touchmove", e => {
    if (!running || touchStartX === null) return;
    e.preventDefault();
    const dx = e.touches[0].clientX - touchStartX;
    moveCatcher(dx*0.5);
    touchStartX = e.touches[0].clientX;

    // Track vertical move for slide refresh
    touchEndY = e.touches[0].clientY;
}, { passive: false });

canvas.addEventListener("touchend", e => {
    // Reset touch X
    touchStartX = null;

    // Slide refresh detection
    if(touchStartY !== null && touchEndY !== null){
        let distance = touchEndY - touchStartY;
        if(distance > 100){ // swipe down threshold
            exitGame(); // reset overlay/game instead of full reload
        }
    }
    touchStartY = null;
    touchEndY = null;
}, { passive: false });

// Mobile arrow buttons (mobile only)
let leftInterval, rightInterval;
document.getElementById("leftArrow").addEventListener("touchstart", e=>{
    e.preventDefault();
    moveCatcher(-10);
    leftInterval = setInterval(()=>moveCatcher(-10), 50);
});
document.getElementById("leftArrow").addEventListener("touchend", e=>{ clearInterval(leftInterval); });

document.getElementById("rightArrow").addEventListener("touchstart", e=>{
    e.preventDefault();
    moveCatcher(10);
    rightInterval = setInterval(()=>moveCatcher(10), 50);
});
document.getElementById("rightArrow").addEventListener("touchend", e=>{ clearInterval(rightInterval); });

/* SPAWN BLOCK */
function spawnBlock(){
    const maxTries = 10;
    let tries=0, newX;
    do{
        newX = Math.random()*(zoneMaxX-zoneX)+zoneX;
        tries++;
        var overlap = blocks.some(b=>Math.abs(b.x-newX)<40+10);
    }while(overlap && tries<maxTries);
    let newBlockY = lastBlockY - 80;
    blocks.push({x:newX, y:newBlockY, size:40});
    lastBlockY = newBlockY;
}

/* GAME LOOP */
function loop(){
    if(!running) return;
    ctx.fillStyle="#05080c";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    difficultyMultiplier = 1 + Math.floor(score/70)*0.15;

    if(Math.random()<0.015*difficultyMultiplier) spawnBlock();

    ctx.fillStyle="#87CEEB";
    ctx.fillRect(catcher.x, catcher.y, catcher.width, catcher.height);

    blocks.forEach((b,i)=>{
        b.y += speed*difficultyMultiplier;
        ctx.fillStyle="#ff4d4d";
        ctx.fillRect(b.x,b.y,b.size,b.size);

        if(b.y+b.size >= catcher.y && b.x+b.size>catcher.x && b.x<catcher.x+catcher.width){
            blocks.splice(i,1);
            score +=10;
        }

        if(b.y>canvas.height) failGame();
    });

    ctx.fillStyle="white";
    ctx.font="20px Arial";
    ctx.textAlign="left";
    ctx.fillText("Score: "+score,20,30);
    ctx.fillText("High Score: "+highScore,20,60);

    requestAnimationFrame(loop);
}

/* START GAME */
function startGame(){
    document.getElementById("controls").style.display="flex";
    init();
    loop();
    music.currentTime=0;
    music.play().catch(()=>{});
}

/* FAIL GAME */
function failGame(){
    if(failed) return;
    failed = true;
    running=false;
    music.pause();

    failMusic.currentTime=0;
    failMusic.play().catch(e=>console.log("Fail music error:",e));

    if(score>highScore){
        highScore=score;
        localStorage.setItem("highScore",highScore);
    }

    blocks=[];

    // Show Game Over container in center
    document.getElementById("gameOverContainer").style.display = "flex";

    // Hide header and main text
    document.querySelector("#overlay h1").style.display="none";
    document.getElementById("mainText").style.display="none";
}

/* EXIT GAME */
function exitGame(){
    running=false;
    music.pause();
    music.currentTime=0;
    blocks=[];
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const overlay=document.getElementById("overlay");
    overlay.classList.remove("top");

    document.querySelector("#overlay h1").style.display="block";
    document.getElementById("mainText").style.display="block";

    document.getElementById("gameOverContainer").style.display="none";

    const overlayContent=document.getElementById("overlayContent");
    Array.from(overlayContent.children).forEach(c=>{
        if(c.id!=="gameOverContainer") c.style.display="block";
    });

    const startBtn=document.getElementById("startBtn");
    startBtn.textContent="Start Game";
    startBtn.style.display="inline-block";

    document.getElementById("controls").style.display="none";
}

/* TOGGLE MUSIC */
function toggleMusic(){
    const btn=document.getElementById("muteBtn");
    if(music.paused){ music.play(); btn.textContent="Mute"; }
    else { music.pause(); btn.textContent="Unmute"; }
}
</script>

</body>
</html>
